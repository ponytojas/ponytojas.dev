---
import SiteLayout from "@/layouts/SiteLayout.astro";
import { getAllBlogPosts, getBlogPostBySlug } from "@/data/blog";
import { formatDate } from "@/lib/formatDate";

export const getStaticPaths = () =>
  getAllBlogPosts().map((post) => ({
    params: { slug: post.slug },
  }));

const slug = Astro.params.slug ?? "";
const post = getBlogPostBySlug(slug);

if (!post) {
  throw new Error(`Missing blog post for slug: ${slug}`);
}

const Content = post.Component;
---

<SiteLayout title={`${post.title} | Daniel Villalobos`} description={post.excerpt}>
  <div class="py-24 md:py-32">
    <div class="container-custom">
      <div class="mb-10">
        <a href="/blog" class="text-sm font-medium text-muted-foreground link-subtle">Back to blog</a>
      </div>

      <header class="mb-12 md:mb-16">
        <div class="flex flex-wrap items-center gap-4 text-reveal" data-text-reveal>
          <time class="text-xs font-mono text-muted-foreground tabular-nums" datetime={post.date}>
            {formatDate(post.date)}
          </time>
          <span class="text-xs font-mono text-muted-foreground/70 tabular-nums">{post.readTime}</span>
        </div>
        <h1
          class="mt-4 text-4xl sm:text-5xl md:text-6xl font-heading font-bold text-foreground text-balance text-reveal"
          style="--reveal-delay: 80ms;"
          data-text-reveal
        >
          {post.title}
        </h1>
        <p class="mt-4 text-muted-foreground text-pretty max-w-2xl text-reveal" style="--reveal-delay: 140ms;" data-text-reveal>
          {post.excerpt}
        </p>
        {
          post.tags && post.tags.length > 0 ? (
            <div class="mt-6 flex flex-wrap gap-2">
              {post.tags.map((tag) => (
                <span class="text-xs font-mono text-muted-foreground/70 border border-border rounded-full px-3 py-1">
                  {tag}
                </span>
              ))}
            </div>
          ) : null
        }
      </header>

      <article class="prose prose-lg dark:prose-invert max-w-none text-pretty prose-headings:text-balance">
        <Content />
      </article>
    </div>
  </div>
</SiteLayout>
